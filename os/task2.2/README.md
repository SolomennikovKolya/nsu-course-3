
### Синхронизация доступа к разделяемому ресурсу
- Измените реализацию очереди, добавив спинлок для синхронизации доступа к разделяемым данным.
- Убедитесь, что не возникает ошибок передачи данных через очередь.
- Поиграйте параметрами из пункта 2.1:
	- Оцените загрузку процессора.
	- Оцените время проведенное в пользовательском режиме и в режиме ядра.
	- Оцените текущую заполненность очереди, количество попыток чтения-записи и количество прочитанных-записанных данных.
	- Объясните наблюдаемые результаты.
- Часто бывает, что поток, пишущий данные в очередь вынужден ожидать их (например, из сети на select()/poll()). Проэмулируйте эту ситуацию, добавив в поточную функцию писателя периодический вызов usleep(1). Выполните задания из пункта с.
- Измените реализацию очереди, заменив спинлок на мутекс. Проделайте задания из пунктов b, c и d. Сравните со спинлоком.
- Измените реализацию очереди, добавив условную переменную. Проделайте задания из пунктов b, c и d. Сравните со спинлоком и мутексом.
- Используйте для синхронизации доступа к очереди семафоры. Проделайте задания из пунктов b, c и d. Сравните со спинлоком, мутексом и условной
 переменной.

### Использование
- `./prog.out <max_count> <reader_core> <writer_core>` - запуск программы (вместо prog - queue-async, queue-spinlock...)
- `time ./prog.out 1000000 1 2` выводит:
	- real: общее время выполнения (на всех процессорах);
	- user: время выполнения программы в пользовательском режиме;
	- sys: время, проведённое в режиме ядра.
- `htop`  - посмотреть подробную информацию о загрузке процессора
- `nproc` - посмотреть, сколько логических процессоров (ядер, в том числе виртуальных) доступно
- `lscpu` - посмотреть характеристики системы

### Результаты

1. queue-aync:
	- На одном ядре:
		- Без задержки:
			- current size 458954; attempts: (30550053 114250191 -83700138); counts (24169097 23710143 458954) ~ 47 * 10^6 удачных операций
			- Загрузка ядер: 100%
		- С usleep(1):
			- current size 0; attempts: (18323 501588642 -501570319); counts (18323 18323 0)
			- Загрузка ядер: 100%
	- На разных ядрах: сразу падает

2. queue-spinlock:
	- На одном ядре:
		- Без задержки:
			- сurrent current size 0; attempts: (37972046 20362190 17609856); counts (2000000 2000000 0) ~ 4 * 10^6 удачных операций
			- Загрузка ядер: 100%
		- С usleep(1):
			- current size 0; attempts: (5 62971254 -62971249); counts (5 5 0)
			- Загрузка ядер: 100%
	- На разных ядрах:
		- Без задержки:
			- current current size 4; attempts: (6428619 10294437 -3865818); counts (6428619 6428615 4) ~ 13 * 10^6 удачных операций
			- Загрузка ядер: 100%, 100%
		- С usleep(1):
			- current size 0; attempts: (15118 122486784 -122471666); counts (15118 15118 0)
			- Загрузка ядер: 100%, 5%
	- Замечания:
		- Переключение потока может произойти в момент, когда спинлок залочен. Из-за этого на одном ядре один из потоков будет делать бесполезные обороты
		- На одном ядре с задаржкой очень плохие результаты из за частого переключения контекста (usleep уступает процессорное время)
		- Квант времени ~= 1-10 миллисекунд

3. queue-mutex:
	- На одном ядре:
		- Без задержки: 
			- current size 511011; attempts: (16429814 24922282 -8492468); counts (16429814 15918803 511011) ~ 32 * 10^6 удачных операций
			- Загрузка ядер: 100%
		- С usleep(1):
			- current size 0; attempts: (17859 67512055 -67494196); counts (17859 17859 0)
			- Загрузка ядер: 100%
	- На разных ядрах:
		- Без задержки:
			- current size 1000000; attempts: (4722953 2465977 2256976); counts (3456137 2456137 1000000) ~ 6 * 10^6 удачных операций
			- Загрузка ядер: 95%, 95%
		- С usleep(1):
			- current size 0; attempts: (15182 73205901 -73190719); counts (15182 15182 0)
			- Загрузка ядер: 100%, 5%

4. queue-condition:
	- На одном ядре:
		- Без задержки: 
			- queue stats: current size 245916; attempts: (15869426 15623510 245916); counts (15869426 15623509 245917) ~ 31 * 10^6 удачных операций
			- Загрузка ядер: 100%
		- С usleep(1):
			- current size 0; attempts: (15244 15245 -1); counts (15244 15244 0)
			- Загрузка ядер: 5%
	- На разных ядрах:
		- Без задержки:
			- queue stats: current size 999564; attempts: (4315902 3316338 999564); counts (4315901 3316338 999563) ~ 8 * 10^6 удачных операций
			- Загрузка ядер: 85%, 60%
		- С usleep(1):
			-current size 0; attempts: (13213 13214 -1); counts (13213 13213 0)
			- Загрузка ядер: 5%, 20%

5. queue-semaphore:
	- На одном ядре:
		- Без задержки: 
			- current size 0; attempts: (15587579 21161739 -5574160); counts (15587579 15587579 0) ~ 31 * 10^6 удачных операций
			- Загрузка ядер: 100%
		- С usleep(1):  
			- current size 0; attempts: (18095 53932766 -53914671); counts (18095 18095 0)
		 	- Загрузка ядер: 100%
	- На разных ядрах:
		- Без задержки:
			- current size 511730; attempts: (2325172 1813757 511415); counts (2325172 1813442 511730) ~ 31 * 10^6 удачных операций
			- Загрузка ядер: 95%, 95%
		- С usleep(1):
			- current size 0; attempts: (14773 54356466 -54341693); counts (14773 14773 0)
			- Загрузка ядер: 100%, 5%
