module drinks;

var $результаты : tuple of Напиток := Напиток[];
var $win;
var $y := 20;

var $вкус, $темп : atom;
var $выбор : integer;
var $кофеин, $молочн, $освеж, $дети, $утро, $натурал : boolean;

rule ввод_критериев
=>
  $win := MakeWindow("Подбор напитка", 0, 0, 1000, 600);

  $выбор := Menu(300, 20, "Какой вкус вы предпочитаете?", atom[сладкий, несладкий, кислый], 1);
  if $выбор = 1 then $вкус := сладкий;
  elsif $выбор = 2 then $вкус := несладкий;
  else $вкус := кислый; end;

  $выбор := Menu(300, 60, "Предпочтение по температуре?", atom[холодный, горячий], 1);
  if $выбор = 1 then $темп := холодный; else $темп := горячий; end;

  $выбор := Menu(300, 100, "Нужен ли кофеин?", atom[да, нет], 2);
  if $выбор = 1 then $кофеин := true; else $кофеин := false; end;

  $выбор := Menu(300, 140, "Нужен ли молочный напиток?", atom[да, нет], 2);
  if $выбор = 1 then $молочн := true; else $молочн := false; end;

  $выбор := Menu(300, 180, "Освежающий?", atom[да, нет], 2);
  if $выбор = 1 then $освеж := true; else $освеж := false; end;

  $выбор := Menu(300, 220, "Для детей?", atom[да, нет], 2);
  if $выбор = 1 then $дети := true; else $дети := false; end;

  $выбор := Menu(300, 260, "Подходит для утра?", atom[да, нет], 2);
  if $выбор = 1 then $утро := true; else $утро := false; end;

  $выбор := Menu(300, 300, "Натуральный?", atom[да, нет], 2);
  if $выбор = 1 then $натурал := true; else $натурал := false; end;
end;

rule подбор_напитков
  forall $нап: Напиток(вкус: $вкус, температура: $темп, кофеин: $кофеин, молочный: $молочн,
                       освежает: $освеж, для_детей: $дети, для_утра: $утро, натуральный: $натурал)
=>
  $результаты := $результаты + Напиток[$нап];
end;

rule рекомендации
=>
  if #$результаты != 0 then
    OutText($win, 20, $y, "Рекомендуемые напитки:");
    $y := $y + 20;
    for $n in $результаты loop
      OutText($win, 40, $y, ToString($n.название));
      $y := $y + 15;
    end;
  else
    OutText($win, 20, $y, "Нет напитков, соответствующих вашему выбору.");
  end;

  $y := $y + 30;

  /* if Ask("Пояснение", "Показать признаки каждого выбранного напитка?") then
    for $n in $результаты loop
      OutText($win, 20, $y, "Характеристики напитка: " + ToString($n.название)); $y := $y + 15;
      OutText($win, 40, $y, "вкус: " + ToString($n.вкус)); $y := $y + 15;
      OutText($win, 40, $y, "температура: " + ToString($n.температура)); $y := $y + 15;
      OutText($win, 40, $y, "кофеин: " + ToString($n.кофеин)); $y := $y + 15;
      OutText($win, 40, $y, "молочный: " + ToString($n.молочный)); $y := $y + 15;
      OutText($win, 40, $y, "освежает: " + ToString($n.освежает)); $y := $y + 15;
      OutText($win, 40, $y, "для детей: " + ToString($n.для_детей)); $y := $y + 15;
      OutText($win, 40, $y, "для утра: " + ToString($n.для_утра)); $y := $y + 15;
      OutText($win, 40, $y, "натуральный: " + ToString($n.натуральный)); $y := $y + 30;
    end;
  end; */

  if Ask("Завершение", "Закрыть окно?") then CloseWindow($win); end;
end;

rule Stop
=>
  activate group();
end;

var $правила : group := group(ввод_критериев, подбор_напитков, рекомендации, Stop );

begin
  new
    @вода: Напиток(название: вода, вкус: несладкий, температура: холодный, кофеин: false, молочный: false, освежает: true, для_детей: true, для_утра: true, натуральный: true),
    @чай: Напиток(название: чай, вкус: несладкий, температура: горячий, кофеин: true, молочный: false, освежает: true, для_детей: true, для_утра: true, натуральный: true),
    @кофе: Напиток(название: кофе, вкус: несладкий, температура: горячий, кофеин: true, молочный: false, освежает: false, для_детей: false, для_утра: true, натуральный: true),
    @какао: Напиток(название: какао, вкус: сладкий, температура: горячий, кофеин: false, молочный: true, освежает: false, для_детей: true, для_утра: true, натуральный: false),
    @молоко: Напиток(название: молоко, вкус: несладкий, температура: холодный, кофеин: false, молочный: true, освежает: false, для_детей: true, для_утра: true, натуральный: true),
    @кефир: Напиток(название: кефир, вкус: кислый, температура: холодный, кофеин: false, молочный: true, освежает: false, для_детей: true, для_утра: false, натуральный: true),
    @сок: Напиток(название: сок, вкус: сладкий, температура: холодный, кофеин: false, молочный: false, освежает: true, для_детей: true, для_утра: true, натуральный: true),
    @газировка: Напиток(название: газировка, вкус: сладкий, температура: холодный, кофеин: false, молочный: false, освежает: true, для_детей: false, для_утра: false, натуральный: false),
    @энергетик: Напиток(название: энергетик, вкус: сладкий, температура: холодный, кофеин: true, молочный: false, освежает: true, для_детей: false, для_утра: true, натуральный: false),
    @компот: Напиток(название: компот, вкус: сладкий, температура: холодный, кофеин: false, молочный: false, освежает: true, для_детей: true, для_утра: false, натуральный: true),
    @лимонад: Напиток(название: лимонад, вкус: кислый, температура: холодный, кофеин: false, молочный: false, освежает: true, для_детей: true, для_утра: false, натуральный: false),
    @йогурт: Напиток(название: йогурт, вкус: сладкий, температура: холодный, кофеин: false, молочный: true, освежает: false, для_детей: true, для_утра: true, натуральный: true),
    @глинтвейн: Напиток(название: глинтвейн, вкус: сладкий, температура: горячий, кофеин: false, молочный: false, освежает: false, для_детей: false, для_утра: false, натуральный: true),
    @шоколадный_напиток: Напиток(название: шоколадный_напиток, вкус: сладкий, температура: горячий, кофеин: false, молочный: true, освежает: false, для_детей: true, для_утра: true, натуральный: false),
    @минеральная_вода: Напиток(название: минеральная_вода, вкус: несладкий, температура: холодный, кофеин: false, молочный: false, освежает: true, для_детей: true, для_утра: true, натуральный: true);
  
  call $правила;
end.
