
### Полезности
- [Гайд для чайников](https://rutube.ru/video/b60fe155ceb1fbe0edc837681fd51ef3/?t=3150&r=plemwd)

### Команды
- `docker login` - авторизация в Docker Hub
- `docker build -t my-python-app .` - сборка образа
- `docker run -d -p 5000:5000 my-python-app` - запуск контейнера
- `docker ps` - проверка состояния контейнера
- `docker stop <CONTAINER_ID или CONTAINER_NAME>` - остановить контейнер
- `http://localhost:8088` - ссылка

**Docker** — это платформа для разработки, доставки и запуска приложений в изолированных средах, называемых контейнерами. Контейнеры позволяют упаковать приложение со всеми его зависимостями (библиотеками, настройками, переменными окружения) в единый переносимый пакет, который можно запускать на любой системе, поддерживающей Docker

![[Pasted image 20250404142805.png]]

### Зачем нужен Docker
1. *Упрощение разработки и развертывания*
	- Docker позволяет разработчикам создавать изолированные среды для приложений, что устраняет проблему "это работает на моей машине, но не на сервере"
	- Приложение, упакованное в контейнер, будет работать одинаково на любой системе, где установлен Docker
2. *Изоляция приложений*
	- Контейнеры изолируют приложения и их зависимости от основной системы и друг от друга
	- Это позволяет избежать конфликтов между версиями библиотек или программ, которые могут возникать при установке всего на одну операционную систему
3. *Переносимость*
	- Контейнеры Docker можно легко переносить между различными средами: с локальной машины разработчика на тестовый сервер, а затем в production
	- Это упрощает процесс CI/CD (непрерывной интеграции и доставки)
4. *Эффективное использование ресурсов*
	- В отличие от виртуальных машин, контейнеры используют общее ядро операционной системы, что делает их более легковесными и быстрыми
	- На одном сервере можно запустить множество контейнеров, экономя ресурсы
5. *Масштабируемость*
	- Docker упрощает масштабирование приложений. Например, с помощью оркестраторов, таких как Kubernetes или Docker Swarm, можно легко запускать несколько копий контейнера для обработки увеличивающейся нагрузки
6. *Упрощение управления зависимостями*
	- Docker позволяет упаковать все зависимости приложения (библиотеки, базы данных, веб-серверы) в один контейнер или набор контейнеров
	- Это избавляет от необходимости вручную устанавливать и настраивать зависимости на каждой машине
7. *Быстрое развертывание*
	- Контейнеры запускаются за секунды, что значительно быстрее, чем развертывание виртуальных машин или установка приложений вручную
	- Всё что нужно для развёртывания это Docker-образ и сам Docker
8. *Стандартизация*
	- Docker предоставляет единый способ упаковки и запуска приложений, что упрощает взаимодействие между разработчиками, тестировщиками и системными администраторами
9. *Экосистема и готовые решения*
	- Docker Hub — это репозиторий готовых образов контейнеров (например, для баз данных, веб-серверов, языков программирования), которые можно использовать в своих проектах
	- Это экономит время на настройку окружения
10. *Поддержка микросервисной архитектуры*
	- Docker идеально подходит для микросервисов, где каждую часть приложения можно упаковать в отдельный контейнер и масштабировать независимо

### Базовые определения


![[Pasted image 20250404144923.png]]

**Docker-образ** (Docker Image) — это шаблон или "снимок" (snapshot), который содержит всё необходимое для запуска приложения (файлы, зависимости, библиотеки, настройки и команды). Образ используется для создания контейнеров. Его можно рассматривать как "рецепт" или "чертеж" для создания контейнера

Основные характеристики Docker-образа:
- *Неизменяемость*: После создания образ нельзя изменить. Любые изменения требуют создания нового образа
- *Слоистая структура*: Образ состоит из нескольких слоев (layers), каждый из которых представляет собой набор изменений (например, установка пакета или добавление файла). Это позволяет эффективно использовать дисковое пространство и ускорять сборку образов

**Docker-контейнер** (Docker Container) — это запущенный экземпляр Docker-образа. Контейнер представляет собой изолированную среду, в которой работает приложение. Он использует ресурсы хостовой системы (например, ядро ОС), но изолирован от других контейнеров и основной системы

Основные характеристики Docker-контейнера:
- *Изоляция*: Контейнеры изолированы друг от друга и от основной системы. У каждого контейнера своя файловая система, сетевые интерфейсы и процессы
- *Легковесность*: Контейнеры используют общее ядро операционной системы, что делает их более легковесными по сравнению с виртуальными машинами
- *Эфемерность*: Контейнеры могут быть легко созданы, остановлены и удалены. Данные внутри контейнера обычно не сохраняются после его удаления (для сохранения данных используются тома (volumes))

**Dockerfile** — это текстовый файл, который содержит инструкции для сборки Docker-образа. Он описывает, как создать образ, какие зависимости установить, какие файлы скопировать и как настроить окружение для запуска приложения

**Volume в Docker** — это механизм для сохранения и управления данными, которые должны сохраняться даже после удаления контейнера. Volumes позволяют отделить данные от контейнера, что делает их устойчивыми к изменениям в контейнере (например, обновлению или удалению). Это особенно полезно для работы с базами данных, логами, конфигурационными файлами и другими важными данными

Зачем нужны Volumes
1. *Сохранение данных*:
    - По умолчанию все данные, созданные внутри контейнера, удаляются при его остановке или удалении. Volumes позволяют сохранить эти данные    
2. *Разделение данных между контейнерами*:
    - Volumes могут использоваться несколькими контейнерами одновременно, что полезно для обмена данными
3. *Производительность*:
    - Volumes работают быстрее, чем привязка файлов из хостовой системы (bind mounts), особенно на Linux
4. *Управление данными*:
    - Volumes управляются Docker, что упрощает их создание, удаление и резервное копирование

**Оркестратор** — это инструмент или платформа, которая автоматизирует управление, развертывание, масштабирование и мониторинг контейнеров и распределенных приложений. Оркестраторы особенно полезны в средах, где используется множество контейнеров, например, в микросервисной архитектуре или при работе с Docker

**Микросервис** — это архитектурный подход к разработке программного обеспечения, при котором приложение разбивается на небольшие, независимые и слабосвязанные компоненты (сервисы). Каждый микросервис отвечает за выполнение одной конкретной бизнес-функции и может разрабатываться, развертываться и масштабироваться независимо от других

Преимущества микросервисов:
1. *Гибкость разработки*: Команды могут работать над разными сервисами одновременно, используя разные технологии
2. *Упрощение поддержки*: Легче находить и исправлять ошибки, так как каждый сервис отвечает за конкретную функцию
3. *Масштабируемость*: Можно масштабировать только те сервисы, которые испытывают высокую нагрузку
4. *Отказоустойчивость*: Если один сервис выходит из строя, это не обязательно влияет на всю систему
5. *Независимость развертывания*: Каждый сервис можно обновлять и развертывать независимо

Недостатки микросервисов:
1. *Сложность управления*: Большое количество сервисов требует сложной инфраструктуры для оркестрации, мониторинга и логирования
2. *Затраты на инфраструктуру*: Необходимость в мощных инструментах для управления микросервисами (например, Kubernetes)
3. *Сложность отладки*: В распределенной системе сложнее отслеживать ошибки и взаимодействие между сервисами
4. *Накладные расходы на взаимодействие*: Сервисы взаимодействуют через сеть, что может увеличивать задержки

### Кросплатформенность 

Контейнеры *не являются полностью платформонезависимыми*, так как они *используют ядро хостовой операционной системы*. Это означает, что если приложение было написано для Windows, оно не сможет работать в контейнере на Linux-сервере без дополнительных усилий

#### Как обеспечивается платформонезависимость?
1. *Использование кросс-платформенных технологий*:
    - Если приложение написано на языке, который поддерживает кросс-платформенность (например, Python, Java, Node.js, Go), оно может работать в контейнере на любой ОС, где установлен Docker и соответствующий runtime
2. *Базовые образы для разных ОС*:
    - Docker поддерживает базовые образы для разных операционных систем. Например:
        - Для Linux: `alpine`, `ubuntu`, `centos`
        - Для Windows: `mcr.microsoft.com/windows/nanoserver`, `mcr.microsoft.com/windows/servercore`
3. *Docker Desktop для Windows и macOS*:
    - На Windows и macOS Docker использует *виртуализацию* для запуска Linux-контейнеров. Например:
        - На Windows Docker Desktop использует WSL 2 или Hyper-V для создания виртуальной машины с Linux, на которой запускаются контейнеры
        - На macOS Docker Desktop использует HyperKit (легковесный гипервизор) для запуска Linux-контейнеров
4. *Мультиархитектурные образы (Multi-Architecture Images)*:
    - Docker поддерживает создание образов для разных архитектур (например, x86, ARM) и операционных систем. Это позволяет использовать один и тот же образ на разных платформах.

#### Ограничения платформонезависимости
1. *Нельзя смешивать*:
    - Один контейнер не может одновременно использовать:
	- Linux-системные вызовы
	- Windows API
2. *Зависимость от ядра ОС*:
    - Хост — Linux:
        - Windows-контейнеры не запустятся (нет совместимости на уровне системных вызовов ядра)
        - Linux-контейнеры работают
    - Хост — Windows:
	- Windows-контейнеры используют ядро Windows NT
	- Linux-контейнеры работают через WSL2
    - Хост — macOS
	- Linux-контейнеры используют ядро этой виртуальной машины (Docker Desktop скрытно создаёт Linux-VM)
	- MacOS-контейнеры работают
3. *Зависимость от архитектуры*:
    - Если приложение скомпилировано для определенной архитектуры (например, x86), оно не будет работать на другой архитектуре (например, ARM) без пересборки или эмуляции
4. *Эмуляция не равно нативное выполнение*: 
    - Даже с WSL2:
	- Linux-контейнеры на Windows имеют накладные расходы (~10-15% производительности)
	- Некоторые низкоуровневые функции (например, FUSE) могут не работать

### Doker Compose

**Docker Compose** — это инструмент для управления многоконтейнерными приложениями через YAML-файл. Он позволяет запускать, связывать и настраивать несколько контейнеров одной командой

Простыми словами: Если Docker — это способ упаковать одно приложение в контейнер, то Docker Compose — это "дирижёр", который управляет целым оркестром контейнеров (бэкенд, фронтенд, БД, Redis и т.д.)

*YML (Yandex Market Language)* — это формат файла, основанный на языке разметки XML, который изначально использовался для передачи данных о товарах в проекты Яндекса (Маркет, Директ)

#### Ключевые возможности
1. *Запуск всех сервисов одной командой*:
	- `docker-compose up`
2. *Автоматическое связывание контейнеров*:
	- Сервисы видят друг друга по именам (например, `backend` может подключиться к `db:5432`)
3. *Управление переменными окружения*:
	- `environment:`
	- `    DB_HOST: db`
4. *Работа с volumes* (для постоянного хранения данных)
5. *Масштабирование* (для dev-среды):
	- `docker-compose up --scale backend=3` - 3 копии бэкенда
    
